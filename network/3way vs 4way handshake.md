# TCP 3-Way / 4-Way Handshake

## 핵심 요약

* **3-Way Handshake**: TCP 연결 성립 과정 (SYN → SYN+ACK → ACK)
* **4-Way Handshake**: TCP 연결 종료 과정 (FIN → ACK → FIN → ACK)

---

## 상세 설명

### 1. 3-Way Handshake (연결 성립)

TCP는 신뢰성 있는 연결을 위해 클라이언트와 서버가 세 번의 패킷 교환으로 연결을 수립한다.

1. **SYN**: 클라이언트가 서버에 연결 요청 (시퀀스 번호 `x`)
2. **SYN + ACK**: 서버가 요청 수락 및 자신의 연결 요청 응답 (시퀀스 번호 `y`, 클라이언트 `x+1` 확인)
3. **ACK**: 클라이언트가 서버의 시퀀스를 확인 (`y+1`)

➡ 결과적으로 양측이 송·수신 가능한 상태로 연결이 성립된다.

---

### 2. 4-Way Handshake (연결 해제)

TCP 연결 종료는 양방향 데이터 전송을 독립적으로 종료하기 때문에 4단계가 필요하다.

1. **FIN**: 클라이언트가 데이터 전송 종료 요청
2. **ACK**: 서버가 수신 확인 (그러나 아직 서버→클라이언트 데이터 전송 가능)
3. **FIN**: 서버도 데이터 전송 종료 요청
4. **ACK**: 클라이언트가 확인 후 연결 완전 종료

➡ 송신과 수신을 각각 종료하기 때문에 4단계 절차가 필요하다.

---

### 3. 3-Way vs 4-Way 비교

| 구분            | 3-Way Handshake              | 4-Way Handshake                  |
| --------------- | ---------------------------- | -------------------------------- |
| 목적             | 연결 성립                      | 연결 종료                         |
| 메시지 교환 횟수   | 3회                           | 4회                               |
| 주요 패킷        | SYN, SYN+ACK, ACK            | FIN, ACK, FIN, ACK                |
| 동작 방식        | 양측 송·수신 준비 동기화            | 각 방향의 데이터 전송 종료를 독립적으로 수행 |

---

### 4. 정리

* **3-Way Handshake** → 연결 시, 송신/수신 상태를 맞추는 과정  
* **4-Way Handshake** → 종료 시, 각 방향의 종료 절차를 따로 진행  
* TCP는 신뢰성과 순서를 보장하기 위해 이 과정을 반드시 거친다.
